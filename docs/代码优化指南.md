# ä»£ç ä¼˜åŒ–æŒ‡å—

**æ›´æ–°æ—¥æœŸ**: 2025-08-21  
**é¡¹ç›®**: Mahavatar Narsimha Movie Website

## å·²å®Œæˆçš„ä¼˜åŒ– âœ…

### 1. å®‰å…¨å¢å¼º
- âœ… åˆ›å»ºäº† API è®¤è¯ä¸­é—´ä»¶ (`/lib/api-auth.ts`)
  - ç»Ÿä¸€çš„èº«ä»½éªŒè¯
  - é€Ÿç‡é™åˆ¶ä¿æŠ¤
  - å®‰å…¨å¤´éƒ¨è®¾ç½®
  - CORS é…ç½®

- âœ… æ›´æ–°äº† API ç«¯ç‚¹ç¤ºä¾‹ (`/app/api/get-user-credits/route.ts`)
  - æ·»åŠ é€Ÿç‡é™åˆ¶
  - æ”¹è¿›é”™è¯¯å¤„ç†
  - ä¸­æ–‡æ³¨é‡Š

### 2. SEO ä¼˜åŒ–
- âœ… åˆ›å»ºäº† SEO å·¥å…·åº“ (`/lib/seo-utils.ts`)
  - ç»Ÿä¸€çš„å…ƒæ•°æ®ç”Ÿæˆå™¨
  - ç»“æ„åŒ–æ•°æ®ç”Ÿæˆå™¨
  - å‡å°‘ä»£ç é‡å¤

### 3. TypeScript é—®é¢˜ä¿®å¤
- âœ… ä¿®å¤äº†æœªä½¿ç”¨çš„å¯¼å…¥
  - `/app/[locale]/watch/mahavatar-narsimha-online/page.tsx`

### 4. è·¯ç”±é—®é¢˜ä¿®å¤
- âœ… ä¿®å¤äº† 404 é”™è¯¯
  - æ›´æ–°ä¸­é—´ä»¶é…ç½®
  - ä¿®å¤é”™è¯¯çš„å†…éƒ¨é“¾æ¥

## å¦‚ä½•ä½¿ç”¨æ–°çš„å·¥å…·

### 1. API è®¤è¯ç¤ºä¾‹
```typescript
// åœ¨éœ€è¦ä¿æŠ¤çš„ API è·¯ç”±ä¸­ä½¿ç”¨
import { requireAuth, rateLimit, getClientIp, apiResponse } from '@/lib/api-auth'

export async function POST(req: NextRequest) {
  // é€Ÿç‡é™åˆ¶
  const ip = getClientIp(req)
  if (!rateLimit(`api:${ip}`, 10, 60000)) {
    return apiResponse(null, 'è¯·æ±‚è¿‡äºé¢‘ç¹', 429)
  }
  
  // èº«ä»½éªŒè¯
  const session = await requireAuth(req)
  if (session instanceof NextResponse) {
    return session // è¿”å›é”™è¯¯å“åº”
  }
  
  // ä½ çš„ä¸šåŠ¡é€»è¾‘
  // ...
}
```

### 2. SEO å…ƒæ•°æ®ç”Ÿæˆç¤ºä¾‹
```typescript
// åœ¨é¡µé¢ä¸­ä½¿ç”¨ç»Ÿä¸€çš„å…ƒæ•°æ®ç”Ÿæˆå™¨
import { generateMovieMetadata } from '@/lib/seo-utils'

export async function generateMetadata({ params }) {
  const { locale } = await params
  
  return generateMovieMetadata(
    'Mahavatar Narsimha Full Movie',
    'è§‚çœ‹ Mahavatar Narsimha å®Œæ•´ç”µå½±...',
    locale,
    `/movie/mahavatar-narsimha`
  )
}
```

### 3. ç»“æ„åŒ–æ•°æ®ç¤ºä¾‹
```typescript
// æ·»åŠ ç»“æ„åŒ–æ•°æ®åˆ°é¡µé¢
import { generateMovieSchema } from '@/lib/seo-utils'

const structuredData = generateMovieSchema({
  name: 'Mahavatar Narsimha',
  description: 'å²è¯—çº§ç¥è¯ç”µå½±...',
  datePublished: '2025-01-01',
  director: 'Director Name',
  actors: ['Actor 1', 'Actor 2'],
  genre: ['Action', 'Drama', 'Mythology'],
  duration: 'PT2H30M',
  aggregateRating: {
    ratingValue: 4.5,
    reviewCount: 1200
  }
})

// åœ¨é¡µé¢ä¸­åµŒå…¥
<script
  type="application/ld+json"
  dangerouslySetInnerHTML={{ __html: JSON.stringify(structuredData) }}
/>
```

## å¾…ä¼˜åŒ–é¡¹ç›®æ¸…å• ğŸ“

### é«˜ä¼˜å…ˆçº§
- [ ] ä¸ºæ‰€æœ‰æ•æ„Ÿ API ç«¯ç‚¹æ·»åŠ è®¤è¯
- [ ] å®æ–½å®Œæ•´çš„é€Ÿç‡é™åˆ¶ç­–ç•¥
- [ ] æ·»åŠ è¾“å…¥éªŒè¯å’Œæ¸…ç†
- [ ] å®æ–½ CSRF ä¿æŠ¤

### ä¸­ä¼˜å…ˆçº§
- [ ] ä¼˜åŒ–å›¾ç‰‡åŠ è½½ï¼ˆä½¿ç”¨ next/imageï¼‰
- [ ] å‡å°‘ Bundle Size
- [ ] å®æ–½æ‡’åŠ è½½
- [ ] æ·»åŠ ç¼“å­˜ç­–ç•¥

### ä½ä¼˜å…ˆçº§
- [ ] æ·»åŠ å•å…ƒæµ‹è¯•
- [ ] æ”¹è¿›æ—¥å¿—è®°å½•
- [ ] ä¼˜åŒ–æ•°æ®åº“æŸ¥è¯¢
- [ ] æ·»åŠ ç›‘æ§å’Œåˆ†æ

## ä»£ç è§„èŒƒ ğŸ“

### 1. æ–‡ä»¶å‘½å
- ç»„ä»¶: `PascalCase.tsx`
- å·¥å…·å‡½æ•°: `kebab-case.ts`
- å¸¸é‡: `UPPER_SNAKE_CASE.ts`

### 2. æ³¨é‡Šè§„èŒƒ
```typescript
/**
 * å‡½æ•°è¯´æ˜
 * @param param å‚æ•°è¯´æ˜
 * @returns è¿”å›å€¼è¯´æ˜
 */
function example(param: string): string {
  // å•è¡Œæ³¨é‡Šè¯´æ˜å…·ä½“é€»è¾‘
  return param
}
```

### 3. é”™è¯¯å¤„ç†
```typescript
try {
  // ä¸šåŠ¡é€»è¾‘
} catch (error) {
  // è®°å½•é”™è¯¯ä½†ä¸æš´éœ²æ•æ„Ÿä¿¡æ¯
  console.error('æ“ä½œå¤±è´¥:', error)
  // è¿”å›ç”¨æˆ·å‹å¥½çš„é”™è¯¯ä¿¡æ¯
  return apiResponse(null, 'æ“ä½œå¤±è´¥ï¼Œè¯·é‡è¯•', 500)
}
```

## æ€§èƒ½ä¼˜åŒ–å»ºè®® ğŸš€

### 1. ä»£ç åˆ†å‰²
```typescript
// ä½¿ç”¨åŠ¨æ€å¯¼å…¥
const Component = dynamic(() => import('./Component'), {
  loading: () => <Loading />,
  ssr: false
})
```

### 2. å›¾ç‰‡ä¼˜åŒ–
```typescript
// ä½¿ç”¨ Next.js Image ç»„ä»¶
import Image from 'next/image'

<Image
  src="/image.jpg"
  alt="æè¿°"
  width={800}
  height={600}
  loading="lazy"
  placeholder="blur"
/>
```

### 3. æ•°æ®é¢„å–
```typescript
// åœ¨æœåŠ¡ç«¯é¢„å–æ•°æ®
export async function generateStaticParams() {
  // é¢„ç”Ÿæˆé™æ€é¡µé¢
  return [
    { locale: 'en' },
    { locale: 'zh' }
  ]
}
```

## å®‰å…¨æœ€ä½³å®è·µ ğŸ”’

### 1. ç¯å¢ƒå˜é‡
- æ°¸ä¸åœ¨å®¢æˆ·ç«¯æš´éœ²æ•æ„Ÿä¿¡æ¯
- ä½¿ç”¨ `NEXT_PUBLIC_` å‰ç¼€ä»…ç”¨äºå…¬å¼€æ•°æ®
- å®šæœŸè½®æ¢å¯†é’¥å’Œä»¤ç‰Œ

### 2. è¾“å…¥éªŒè¯
```typescript
// éªŒè¯ç”¨æˆ·è¾“å…¥
import { z } from 'zod'

const schema = z.object({
  email: z.string().email(),
  password: z.string().min(8)
})

const result = schema.safeParse(input)
if (!result.success) {
  return apiResponse(null, 'è¾“å…¥æ— æ•ˆ', 400)
}
```

### 3. SQL æ³¨å…¥é˜²æŠ¤
```typescript
// ä½¿ç”¨å‚æ•°åŒ–æŸ¥è¯¢
const query = 'SELECT * FROM users WHERE id = $1'
const values = [userId]
// ä¸è¦ä½¿ç”¨å­—ç¬¦ä¸²æ‹¼æ¥
```

## ç›‘æ§å’Œæ—¥å¿— ğŸ“Š

### 1. é”™è¯¯è·Ÿè¸ª
```typescript
// é›†æˆ Sentry
import * as Sentry from '@sentry/nextjs'

Sentry.captureException(error, {
  tags: {
    section: 'api',
    action: 'user-credits'
  }
})
```

### 2. æ€§èƒ½ç›‘æ§
```typescript
// ä½¿ç”¨ Performance API
const startTime = performance.now()
// æ‰§è¡Œæ“ä½œ
const endTime = performance.now()
console.log(`æ“ä½œè€—æ—¶: ${endTime - startTime}ms`)
```

## æŒç»­æ”¹è¿›è®¡åˆ’ ğŸ“ˆ

### ç¬¬ä¸€é˜¶æ®µï¼ˆæœ¬å‘¨ï¼‰
1. å®Œæˆæ‰€æœ‰ API ç«¯ç‚¹çš„å®‰å…¨åŠ å›º
2. ç»Ÿä¸€é”™è¯¯å¤„ç†æœºåˆ¶
3. ä¼˜åŒ–å…³é”®é¡µé¢æ€§èƒ½

### ç¬¬äºŒé˜¶æ®µï¼ˆä¸‹å‘¨ï¼‰
1. å®æ–½å®Œæ•´çš„æµ‹è¯•ç­–ç•¥
2. ä¼˜åŒ–æ•°æ®åº“æŸ¥è¯¢
3. æ”¹è¿›ç¼“å­˜ç­–ç•¥

### ç¬¬ä¸‰é˜¶æ®µï¼ˆæœˆåº•å‰ï¼‰
1. å®Œæˆå›½é™…åŒ–ä¼˜åŒ–
2. å®æ–½ PWA åŠŸèƒ½
3. æ·»åŠ  A/B æµ‹è¯•èƒ½åŠ›

## ç›¸å…³èµ„æº ğŸ“š

- [Next.js æ–‡æ¡£](https://nextjs.org/docs)
- [TypeScript æ‰‹å†Œ](https://www.typescriptlang.org/docs/)
- [Web.dev æ€§èƒ½æŒ‡å—](https://web.dev/performance/)
- [OWASP å®‰å…¨æŒ‡å—](https://owasp.org/)

---

**æ³¨æ„**: è¯·å®šæœŸæ›´æ–°æ­¤æ–‡æ¡£ä»¥åæ˜ æœ€æ–°çš„ä¼˜åŒ–çŠ¶æ€ã€‚
# Mahavatar Narsimha 开发指南

## 快速开始

### 环境要求
- Node.js 18.17 或更高版本
- pnpm 8.0 或更高版本
- Git

### 安装步骤

#### 1. 克隆项目
```bash
git clone [repository-url]
cd movieIndia
```

#### 2. 安装依赖
```bash
pnpm install
```

#### 3. 环境配置
```bash
# 复制环境变量模板
cp .env.example .env.local

# 编辑.env.local文件，填入必要的配置
```

#### 4. 启动开发服务器
```bash
pnpm dev
```

访问 http://localhost:3000 查看项目

## 项目结构说明

```
movieIndia/
├── app/                    # Next.js App Router目录
│   ├── [locale]/          # 国际化路由
│   ├── api/               # API接口
│   └── (legal)/           # 法律页面组
├── components/            # React组件
│   ├── ui/               # 基础UI组件(shadcn/ui)
│   ├── blocks/           # 页面区块组件
│   └── movie/            # 电影相关组件
├── services/             # 业务逻辑层
├── models/               # 数据模型层
├── i18n/                 # 国际化配置
├── docs/                 # 项目文档（新建）
└── public/               # 静态资源
```

## 开发规范

### 1. 代码风格

#### TypeScript规范
```typescript
// ✅ 好的实践
interface MovieData {
  id: string
  title: string
  releaseDate: Date
}

// 使用明确的类型定义
function getMovie(id: string): Promise<MovieData> {
  // 实现逻辑
}

// ❌ 避免使用any
function processData(data: any) {
  // 不推荐
}
```

#### 组件开发规范
```typescript
// components/movie/MovieCard.tsx
// ✅ 组件命名使用PascalCase
export function MovieCard({ movie }: { movie: MovieData }) {
  return (
    <div className="movie-card">
      {/* 使用语义化的className */}
      <h3>{movie.title}</h3>
    </div>
  )
}
```

#### 中文注释规范
```typescript
/**
 * 获取电影详情
 * @param id - 电影ID
 * @returns 电影详情数据
 */
export async function getMovieDetail(id: string) {
  // 从数据库获取电影信息
  const movie = await MovieModel.findById(id)
  
  // 处理数据格式
  return formatMovieData(movie)
}
```

### 2. 文件命名规范

```
页面文件: page.tsx
布局文件: layout.tsx
组件文件: PascalCase.tsx (如: MovieCard.tsx)
工具函数: camelCase.ts (如: formatDate.ts)
样式文件: kebab-case.css (如: movie-card.css)
```

### 3. Git提交规范

```bash
# 功能开发
feat: 添加电影详情页面

# 错误修复
fix: 修复404页面路由问题

# 样式调整
style: 优化移动端响应式布局

# 文档更新
docs: 更新开发指南

# 性能优化
perf: 优化图片加载性能

# 重构
refactor: 重构支付服务逻辑
```

## 常用开发任务

### 添加新页面

#### 1. 创建页面文件
```typescript
// app/[locale]/new-page/page.tsx
export default function NewPage() {
  return (
    <div>
      <h1>新页面</h1>
    </div>
  )
}
```

#### 2. 添加国际化支持
```json
// i18n/messages/en.json
{
  "newPage": {
    "title": "New Page",
    "description": "This is a new page"
  }
}

// i18n/messages/zh.json
{
  "newPage": {
    "title": "新页面",
    "description": "这是一个新页面"
  }
}
```

### 添加API接口

```typescript
// app/api/movies/[id]/route.ts
import { NextRequest, NextResponse } from 'next/server'

// GET请求 - 获取电影详情
export async function GET(
  request: NextRequest,
  { params }: { params: { id: string } }
) {
  try {
    const movie = await MovieService.getById(params.id)
    return NextResponse.json(movie)
  } catch (error) {
    return NextResponse.json(
      { error: '电影不存在' },
      { status: 404 }
    )
  }
}

// POST请求 - 更新电影信息
export async function POST(request: NextRequest) {
  const data = await request.json()
  // 处理逻辑
}
```

### 使用shadcn/ui组件

```bash
# 添加新组件
pnpm dlx shadcn-ui@latest add button

# 使用组件
```

```typescript
import { Button } from '@/components/ui/button'

export function MovieActions() {
  return (
    <Button variant="default" size="lg">
      立即观看
    </Button>
  )
}
```

### 添加新的服务

```typescript
// services/boxoffice.ts
export class BoxOfficeService {
  /**
   * 获取票房数据
   */
  static async getBoxOfficeData() {
    // 从API或数据库获取数据
    const data = await fetch('/api/box-office')
    return data.json()
  }
  
  /**
   * 更新票房数据
   */
  static async updateBoxOffice(movieId: string, amount: number) {
    // 更新逻辑
  }
}
```

## 数据库操作

### 使用Supabase

```typescript
// models/db.ts
import { createClient } from '@supabase/supabase-js'

const supabase = createClient(
  process.env.SUPABASE_URL!,
  process.env.SUPABASE_ANON_KEY!
)

// 查询示例
export async function getMovies() {
  const { data, error } = await supabase
    .from('movies')
    .select('*')
    .order('created_at', { ascending: false })
  
  if (error) throw error
  return data
}
```

## 测试

### 运行测试
```bash
# 运行所有测试
pnpm test

# 运行特定测试文件
pnpm test MovieCard.test.tsx

# 测试覆盖率
pnpm test:coverage
```

### 编写测试用例
```typescript
// components/movie/__tests__/MovieCard.test.tsx
import { render, screen } from '@testing-library/react'
import { MovieCard } from '../MovieCard'

describe('MovieCard', () => {
  it('应该正确显示电影标题', () => {
    const movie = {
      id: '1',
      title: 'Mahavatar Narsimha',
      releaseDate: new Date()
    }
    
    render(<MovieCard movie={movie} />)
    expect(screen.getByText('Mahavatar Narsimha')).toBeInTheDocument()
  })
})
```

## 部署

### Vercel部署
```bash
# 安装Vercel CLI
pnpm i -g vercel

# 部署到Vercel
vercel

# 部署到生产环境
vercel --prod
```

### Docker部署
```bash
# 构建Docker镜像
docker build -t mahavatar-narsimha .

# 运行容器
docker run -p 3000:3000 mahavatar-narsimha
```

## 常见问题解决

### 1. 依赖安装失败
```bash
# 清理缓存
pnpm store prune

# 删除node_modules和锁文件
rm -rf node_modules pnpm-lock.yaml

# 重新安装
pnpm install
```

### 2. TypeScript类型错误
```bash
# 重新生成类型定义
pnpm typecheck

# 清理TypeScript缓存
rm -rf .next
```

### 3. 环境变量未生效
```bash
# 确保.env.local文件存在
# 重启开发服务器
pnpm dev
```

## 性能优化建议

### 1. 图片优化
- 使用Next.js Image组件
- 提供不同尺寸的图片
- 使用WebP格式
- 启用懒加载

### 2. 代码分割
- 使用动态导入
- 按路由分割代码
- 优化第三方库导入

### 3. 缓存策略
- 使用ISR（增量静态再生）
- 配置合适的revalidate时间
- 使用CDN缓存静态资源

## 调试技巧

### 使用Chrome DevTools
```typescript
// 在代码中添加断点
debugger

// 控制台日志
console.log('调试信息:', data)

// 性能标记
performance.mark('start')
// ... 代码执行
performance.mark('end')
performance.measure('执行时间', 'start', 'end')
```

### 使用React Developer Tools
- 检查组件树
- 查看props和state
- 分析组件渲染

## 相关资源

### 官方文档
- [Next.js文档](https://nextjs.org/docs)
- [TypeScript文档](https://www.typescriptlang.org/docs)
- [Tailwind CSS文档](https://tailwindcss.com/docs)
- [shadcn/ui文档](https://ui.shadcn.com)

### 项目相关
- [项目概述](./项目概述.md)
- [技术架构文档](./技术架构文档.md)
- [SEO问题分析](./SEO问题分析.md)

### 工具推荐
- VSCode扩展：
  - ESLint
  - Prettier
  - Tailwind CSS IntelliSense
  - TypeScript Vue Plugin

---

**文档版本**: v1.0.0  
**更新日期**: 2025-08-18  
**维护者**: 开发团队